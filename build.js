var config={PRODUCT_URL:"https://product-list-js.herokuapp.com/products",REEVIEW_URL:"https://product-list-js.herokuapp.com/review/",MAX_STARS:5,MAX_SHOW_REVIEW:10,MAX_CHAR_PER_LINE:100},inMemory={SELECTED_PRODUCT:1,products:[],selectedStar:0,reviewDiscription:"",reviewTitle:"",reviews:[],noReviews:config.MAX_SHOW_REVIEW},request=function(){var e=new XMLHttpRequest;function t(){4==e.readyState&&200==e.status&&(inMemory.products=JSON.parse(e.responseText),renderPage(inMemory.products))}function r(){4==e.readyState&&200==e.status&&(inMemory.reviews=JSON.parse(e.responseText),mergeReview(),reviewItems())}return{getProducts:function(){e.open("GET",config.PRODUCT_URL,!0),e.send(),e.onreadystatechange=t},getReviews:function(t){e.open("GET",config.REEVIEW_URL+t,!0),e.send(),e.onreadystatechange=r}}}();function onLoad(){genarateProductTiles(),renderReviewStars()}function renderPage(e,t){e&&e.length&&(t=t||e[0].id,genarateTile(e),genarateReviewSection(t))}function genarateTile(e){for(var t="",r=0;r<e.length;r++)t+=productTile(e[r],r);document.getElementById("tiles").innerHTML=t}function getProductstar(e){return'<span class="product_rating"><div class="rating_star">'+e.average+" ★ </div></span>"}function getProductReviewInfo(e){return'<span class="prd_rating_review"><span>'+e.ratingCount+"  Ratings &   "+e.reviewCount+"  Reviews </span></span>"}function getStarName(){var e=getRatingText(inMemory.selectedStar)||"";return document.getElementById("startText").innerHTML='<span class="'+e.toLowerCase()+'">'+e+" </span>","defaultStar "+e.toLowerCase()}function getRatingText(e){return e<3?"Average":e>=3&&e<4?"Good":e>=4?"Excellent":void 0}function stars(e,t){return"<span data-star="+e+' class="'+(t?getStarName(e):"defaultStar")+'">★</span>'}function renderReviewStars(){var e="";for(let t=1;t<=config.MAX_STARS;t++)e+=stars(t,t<=inMemory.selectedStar);var t='<div class="starts" onclick="starSelection()">'+e+"</div>";document.getElementById("star").innerHTML=t}function productTile(e,t){var r=e.rating,n=getProductReviewInfo(r),a=getProductstar(r),i=inMemory.SELECTED_PRODUCT===e.id?"product_tile selected":"product_tile";return'<div onclick="productSelection('+e.id+')"class="'+i+'"><img class="product_image" src="'+e.productImage+'"/><div class="productInfo"><strong>'+e.title+'</strong><div class="ratingWrapper">'+a+n+'</div><div class="product_price"> र '+e.pricing.value+"</div></div></div>"}function getReviewItem(e){var t=getProductstar({average:e.rating}),r=reviewDiscription(e.text);return'<div class="ratingWrapper">'+t+'<span class="prd_rating_review"><span>'+e.title+'</span></span><ul class="reviewList">'+r+'</ul><span class="reviewCreator"><span> <pre class="clr">'+e.userName+"   "+formatDate(e.created)+'</pre></span> </span><hr class="hr"></div>'}function reviewDiscription(e){var t=(e||"").split("."),r="";for(let e=0;e<t.length;e++)r+="<li>"+t[e]+"</li>";return r}function reviewItems(){for(var e="",t=inMemory.reviews,r=t.length,n=0;n<r;n++)e=getReviewItem(t[n])+e;document.getElementById("col").innerHTML=e}function genarateProductTiles(){request.getProducts()}function genarateReviewSection(e){request.getReviews(e)}function productSelection(e){inMemory.SELECTED_PRODUCT=e,mergeReview(),renderReviewStars(),renderPage(inMemory.products,e),document.getElementById("error").innerHTML=""}function starSelection(){inMemory.selectedStar=parseInt(event.target.getAttribute("data-star")),setlocalStorage(inMemory.SELECTED_PRODUCT,{star:inMemory.selectedStar}),renderReviewStars()}function formatDate(e){var t=new Date(e),r=t.getDate(),n=t.getMonth(),a=t.getFullYear();return r+" "+["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][n]+", "+a}function setlocalStorage(e,t){if("undefined"!=typeof Storage){var r={...getFromLocalStorage(e),...t};localStorage.setItem(e,JSON.stringify(r))}}function getFromLocalStorage(e){if("undefined"!=typeof Storage)return JSON.parse(localStorage.getItem(e))}function mergeReview(){var e=getFromLocalStorage(inMemory.SELECTED_PRODUCT);if(e){var t={created:new Date,id:"5b1a8a5e14bad453a7bc8430",rating:parseInt(e.star),text:e.reviewDiscription,title:e.reviewTitle||"",userName:"Arun"};inMemory.reviews.push(t)}}function saveReviews(){document.getElementById("error").innerHTML="";var e=document.getElementById("discriptionData").value||"";if(e.length){e=e.match(/.{1,100}/g).join(".");var t=document.getElementById("titleData").value;document.getElementById("discriptionData").value="",document.getElementById("titleData").value="";var r={reviewDiscription:e,reviewTitle:t};setlocalStorage(inMemory.SELECTED_PRODUCT,r),mergeReview(),reviewItems()}else document.getElementById("error").innerHTML="<span> Review discription is required </span>"}